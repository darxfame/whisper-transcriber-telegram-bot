# üöÄ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ Docker

## –ü—Ä–æ–±–ª–µ–º–∞: –î–æ–ª–≥–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `docker-compose up -d --build` –∫–∞—á–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ, –≤–∫–ª—é—á–∞—è —Ç—è–∂–µ–ª—ã–µ pytorch/transformers.

## –†–µ—à–µ–Ω–∏–µ: –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞ (multi-stage build)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

Dockerfile —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤–∞ —ç—Ç–∞–ø–∞**:

1. **Builder** - –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ wheels
   - –°–æ–¥–µ—Ä–∂–∏—Ç gcc, g++, python-dev (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏)
   - –í—ã–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ wheels
   - **Docker –∫—ç—à–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç —Å–ª–æ–π!**

2. **Runtime** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ wheels
   - –ú–∞–ª–µ–Ω—å–∫–∏–π –æ–±—Ä–∞–∑ (–±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞)
   - –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏)
   - **–°–ª–æ–π –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ requirements.txt –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è**

### –†–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ - –º–µ–¥–ª–µ–Ω–Ω–æ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
docker-compose up -d --build    # ~5-10 –º–∏–Ω—É—Ç

# –í—Ç–æ—Ä–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ - –ë–´–°–¢–†–û! ‚ö°
docker-compose up -d --build    # ~10-20 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ –∫–æ–¥, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ –∫—ç—à–∞)
```

### –ö–∞–∫ Docker –∫—ç—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏

```dockerfile
# –°–ª–æ–π 1: –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è)
FROM python:3.12-slim as builder

# –°–ª–æ–π 2: —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ)
RUN apt-get install ...

# –°–ª–æ–π 3: requirements.txt (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∫–∞ —Ñ–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è) ‚≠ê
COPY requirements.txt .

# –°–ª–æ–π 4: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ wheels (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è) ‚≠ê‚≠ê
RUN pip wheel ...

# ... —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ ...

# –°–ª–æ–π 5: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ wheels (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è)
COPY --from=builder /wheels /wheels

# –°–ª–æ–π 6: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è requirements.txt)
RUN pip install --no-index --find-links=/wheels ...

# –°–ª–æ–π 7: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞!)
COPY . .
```

## –í–∞–∂–Ω–æ

‚ö†Ô∏è **–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è `requirements.txt`** - Docker –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç wheels —Å –Ω—É–ª—è.

‚úÖ **–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–¥** (`userbot.py` –∏ —Ç.–¥.) - wheels –∏–∑ –∫—ç—à–∞, –±—ã—Å—Ç—Ä–æ!

## –†–∞–∑–º–µ—Ä—ã –æ–±—Ä–∞–∑–æ–≤

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```
base python:3.12-slim        ~150 MB
+ gcc, g++, build tools      ~200 MB
+ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pytorch, etc) ~800 MB
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û                        ~1150 MB
```

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞)
```
builder stage (–≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç—Å—è!)

runtime stage:
base python:3.12-slim        ~150 MB
+ —Ç–æ–ª—å–∫–æ runtime tools       ~50 MB
+ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (wheels)       ~800 MB
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û                        ~1000 MB ‚úÖ –º–µ–Ω—å—à–µ –Ω–∞ 150 MB
```

## –ö–æ–º–∞–Ω–¥—ã

```bash
# –û–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ (—Å –∫—ç—à–µ–º)
docker-compose build

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ë–ï–ó –∫—ç—à–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å)
docker-compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
docker images | grep voicebot
```

## –ß—Ç–æ –µ—â–µ —É—Å–∫–æ—Ä—è–µ—Ç?

### `.dockerignore`
–ò—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ COPY:
- `.git` - –Ω–µ –Ω—É–∂–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- `docs/` - —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- `__pycache__` - –∫—ç—à Python
- `.env` - –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –æ–±—Ä–∞–∑–µ
- `logs/`, `temp/` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ü–æ—Ä—è–¥–æ–∫ COPY
```dockerfile
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: —Å–Ω–∞—á–∞–ª–∞ requirements, –ø–æ—Ç–æ–º –∫–æ–¥
COPY requirements.txt .
RUN pip install ...
COPY . .

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –∫–æ–¥ –º–µ–Ω—è–µ—Ç—Å—è —á–∞—Å—Ç–æ, –∫—ç—à —Å–±–∏–≤–∞–µ—Ç—Å—è
COPY . .
RUN pip install ...
```

## –ò—Ç–æ–≥–æ

- ‚ö° –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞: ~5-10 –º–∏–Ω—É—Ç (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- ‚ö° –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞: ~10-20 —Å–µ–∫—É–Ω–¥ (wheels –∏–∑ –∫—ç—à–∞)
- üìâ –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞: –Ω–∞ 150 MB –º–µ–Ω—å—à–µ
- üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è.txt –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ ‚Üí –∫—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

---

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 2026-02-18

