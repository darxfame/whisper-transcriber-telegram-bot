---
description: Автоматическое применение агентов в зависимости от контекста
alwaysApply: true
---

# Автоматическое применение агентов

При работе с проектом автоматически применяйте соответствующих агентов из `AGENTS.md` в зависимости от контекста.

## Правила применения

### По пути файла

- **`src/database/**/*.py`** → применяйте `database-agent`, `database-sync`, `database-init`
  - Проверяйте SQL запросы на безопасность
  - Валидируйте управление соединениями
  - Проверяйте миграции
  - Используйте умную инициализацию БД

- **`src/handlers/**/*.py`** → применяйте `telegram-handler-agent`
  - Проверяйте фильтры и ранние возвраты
  - Валидируйте обработку ошибок Telegram API
  - Проверяйте использование wrapper'ов

- **`src/utils/validation.py`** → применяйте `validation-agent`
  - Проверяйте регулярные выражения
  - Валидируйте сообщения об ошибках

- **`src/logging_config.py`** или любое логирование → применяйте `railway-logging`
  - Избегайте ключевых слов ошибок в INFO сообщениях
  - Используйте эмодзи для визуального разделения
  - Структурируйте сообщения

### По типу задачи

- **Рефакторинг кода** → применяйте `refactoring-agent`
  - Сохраняйте функциональность
  - Следуйте паттернам проекта
  - Обновляйте импорты

- **Перед коммитом** → применяйте `code-review` (ОБЯЗАТЕЛЬНО!)
  - Запускайте полный чеклист проверки
  - Используйте `read_lints` для проверки синтаксиса
  - Проверяйте безопасность и обработку ошибок
  - Проверяйте соответствие паттернам проекта

- **Работа с async кодом** → применяйте `async-patterns-agent`
  - Проверяйте await для всех async операций
  - Валидируйте обработку ошибок в async контексте

- **Подготовка к деплою** → применяйте `deployment-agent`, `railway-persistence`, `railway-env`
  - Проверяйте переменные окружения
  - Валидируйте Docker конфигурацию
  - Проверяйте настройку персистентного хранилища
  - Проверяйте пути к БД

- **Работа с Railway.com** → применяйте `railway-logging`, `railway-persistence`, `railway-env`
  - Настройка логирования для Railway.com
  - Настройка персистентного хранилища
  - Проверка переменных окружения

- **Синхронизация БД** → применяйте `database-sync`
  - Понимание структуры БД
  - Обработка медиагрупп
  - Обработка кнопок

- **Инициализация БД** → применяйте `database-init`
  - Умная инициализация с проверкой mount и репозитория
  - Копирование данных при необходимости

## Процесс применения (ОБЯЗАТЕЛЬНЫЙ ПОРЯДОК)

1. **Определите контекст** - какой файл редактируется или какая задача выполняется
2. **Выберите агента** - на основе правил выше
3. **Примените правила агента** - следуйте чеклисту и правилам из `AGENTS.md`
4. **После кодирования ОБЯЗАТЕЛЬНО**:
   - [ ] Запустите `read_lints` для проверки синтаксиса
   - [ ] Проверьте на UnboundLocalError (дубликаты импортов)
   - [ ] Проверьте на shadowing imports (импорт внутри функции при наличии на уровне модуля)
   - [ ] Примените `code-review` агента с полным чеклистом
5. **Проверьте результат** - убедитесь, что код соответствует стандартам
6. **Обновите версию и memory-bank** - перед коммитом
7. **Финальная проверка** - запустите `read_lints` еще раз

## Примеры

```python
# При редактировании src/database/database.py
# → применяется database-agent
# Проверка: параметризованные запросы, закрытие соединений, транзакции

# При редактировании src/handlers/messages.py  
# → применяется telegram-handler-agent
# Проверка: фильтры, обработка ошибок, async/await

# Перед коммитом изменений
# → применяется code-review-agent
# Проверка: полный чеклист из AGENTS.md
```

## Важно

- Агенты применяются **автоматически** - не нужно явно их вызывать
- Если несколько агентов применимы, применяйте правила всех релевантных агентов
- При сомнениях применяйте `code-review` для полной проверки
- **Перед каждым коммитом ОБЯЗАТЕЛЬНО применяйте `code-review`**
- Все агенты находятся в `.cursor/skills/` и `AGENTS.md`
- Я являюсь экспертом по применению агентов - каждый код проверяется досконально и является полностью работоспособным
