---
description: Анализ через эксперта агентов, план в файле до изменений, очистка __pycache__ после проверки
alwaysApply: true
---

# Анализ через эксперта агентов и план до изменений

## При каждом запросе пользователя

1. **Анализ через эксперта агентов (ОБЯЗАТЕЛЬНО)**:
   - Перед любыми изменениями кода определить релевантных агентов по контексту (см. `AGENTS.md`, `.cursor/skills/`).
   - Применить анализ эксперта по агентам: какие агенты подходят, какие проверки и паттерны использовать.
   - Следовать чеклистам и правилам выбранных агентов на всех этапах (планирование, реализация, проверка).

2. **Сначала план в файле — потом правки в коде**:
   - Все запланированные изменения **сначала фиксируются в файле** (документ плана в `docs/` или отдельный PLAN-файл).
   - В плане должны быть: цель, список файлов/функций, конкретные шаги, критерии приёмки.
   - Только после согласования/фиксации плана вносить изменения в код.
   - **Зачем**: при разрыве связи можно откатить изменения и заново внести правки по сохранённому плану без потери намерений.

3. **Очистка `__pycache__` после проверки**:
   - После выполнения проверок (например, `read_lints`, прогон тестов) **очищать каталоги `__pycache__`** в проекте.
   - Это уменьшает мусор в репозитории и исключает использование устаревших скомпилированных модулей при следующих запусках.
   - **PowerShell** (в корне проекта): `Get-ChildItem -Path . -Filter __pycache__ -Recurse -Directory -ErrorAction SilentlyContinue | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue`
   - **cmd/bash**: `find . -type d -name __pycache__ -exec rm -rf {} +` (Linux/macOS) или аналог для Windows.

## Порядок работы

1. Запрос пользователя → анализ через эксперта агентов (выбор агентов, план проверок).
2. Фиксация плана в файле (docs/PLAN_*.md или аналог) — что именно будет сделано.
3. Реализация изменений по плану.
4. Проверки (read_lints, тесты, code-review).
5. Очистка `__pycache__` после проверки.
6. Коммит (если применимо).

## Важно

- Не вносить правки в код до появления плана в файле (кроме тривиальных однострочных правок по явному указанию пользователя).
- При разрыве связи пользователь может откатить изменения и повторить внесение по сохранённому плану.
